/*!
 * jQuery ClassyScroll
 * http://www.class.pm/projects/jquery/classyscroll
 *
 * Copyright 2011 - 2013, Class.PM www.class.pm
 * Written by Marius Stanciu - Sergiu <marius@picozu.net>
 * Licensed under the GPL Version 3 license.
 * Version 1.1.0
 *
*/
(function(a){function b(e,d){this.container=a(e);this.settings=d;this.timer=0;this.before={v:0,h:0};this.touch={};this.pressed=0;this.vslider=a("<div/>",{"class":"scrollbar-handle"});this.vpath=a("<div/>",{"class":"scrollbar-path-vertical"});this.hslider=a("<div/>",{"class":"scrollbar-handle"});this.hpath=a("<div/>",{"class":"scrollbar-path-horizontal"});this.sliders=this.vslider.add(this.hslider);this.container.css({overflow:"hidden",position:"relative"}).contents().filter(this.settings.contentFilter).wrapAll('<div class="scrollbar-content"></div>');this.content=this.container.children(".scrollbar-content").css({top:0,left:0,position:"relative","float":"left"});if(this.settings.scroll=="horizontal"){this.container.prepend(this.hpath.append(this.hslider))}else{if(this.settings.scroll=="vertical"){this.container.prepend(this.vpath.append(this.vslider))}else{this.container.prepend(this.vpath.append(this.vslider),this.hpath.append(this.hslider))}}this.vpath.add(this.hpath).css({"z-index":this.settings.zIndex,display:"none"});this.vslider.css({height:this.settings.sliderSize,opacity:this.settings.sliderOpacity});this.hslider.css({width:this.settings.sliderSize,opacity:this.settings.sliderOpacity});if(this.settings.sliderOpacity){this.sliders.hover(this.fixFn(function(){this.sliders.stop().fadeTo(this.settings.sliderOpacityTime,1)}),this.fixFn(function(){if(!this.pressed){this.sliders.stop().fadeTo(this.settings.sliderOpacityTime,this.settings.sliderOpacity)}}))}this.init();this.pathSize();this.bindEvent(a(window),"load",function(){setTimeout(this.fixFn(this.checkScroll),10)});if(this.settings.lazyCheckScroll>0){setInterval(this.fixFn(this.checkScroll),this.settings.lazyCheckScroll)}}b.prototype.checkScroll=function(){this.vtrack=this.vpath.height()-this.vslider.height();this.htrack=this.hpath.width()-this.hslider.width();this.vdiff=this.content.height()-this.container.height();this.hdiff=this.content.width()-this.container.width();if(!this.settings.autoHide){return}if(this.vdiff>0){this.vpath.fadeIn(this.settings.autoHideTime)}else{this.vpath.fadeOut(this.settings.autoHideTime)}if(this.hdiff>0){this.hpath.fadeIn(this.settings.autoHideTime)}else{this.hpath.fadeOut(this.settings.autoHideTime)}};b.prototype.pathSize=function(){var c=parseInt(this.settings.pathPadding,10);this.vpath.css({top:c+"px",height:this.container.height()-2*c+"px"});this.hpath.css({left:c+"px",width:this.container.width()-2*c+"px"})};b.prototype.scroll=function(f,g,i){var d=0;var c=0;if(f<0){f=0}if(f>this.vtrack){f=this.vtrack}this.vslider.css("top",f+"px");if(g<0){g=0}if(g>this.htrack){g=this.htrack}this.hslider.css("left",g+"px");if(this.vdiff>0){c=f/this.vtrack;this.content.css("top",Math.round(-this.vdiff*c));if(i&&(f&&f!=this.vtrack)){i.stopPropagation();i.preventDefault()}}if(this.hdiff>0){d=g/this.htrack;this.content.css("left",Math.round(-this.hdiff*d));if(i&&(g&&g!=this.htrack)){i.stopPropagation();i.preventDefault()}}if(this.before.v!=c||this.before.h!=d){if(typeof this.settings.onscroll=="function"){this.settings.onscroll.call(this.container.get(0),c,d)}this.before.v=c;this.before.h=d}};b.prototype.easeScroll=function(g,i){var l=0;var f=Math.floor(this.settings.scrollTime/this.settings.scrollInterval);var e=this.vslider.position().top;var k=this.hslider.position().left;var j=a.easing[this.settings.scrollEasing]||a.easing.linear;this.sliders.stop().fadeTo(this.settings.sliderOpacityTime,1);window.clearInterval(this.timer);this.timer=window.setInterval(this.fixFn(function(){this.scroll(e+j(l/f,l,0,1,f)*g,k+j(l/f,l,0,1,f)*i);if(++l>f){window.clearInterval(this.timer);this.sliders.stop().fadeTo(this.settings.sliderOpacityTime,this.settings.sliderOpacity)}}),this.settings.scrollInterval)};b.prototype.fixFn=function(e,d){var c=this;return function(){e.apply(d||c,Array.prototype.slice.call(arguments))}};b.prototype.bindEvent=function(c,h,g,d){return c.bind(h,this.fixFn(g,d))};b.prototype.init=function(){var d=a(window.document);this.bindEvent(this.sliders,"mousedown",function(h){this.pressed=(h.target===this.vslider.get(0))?1:2;var g=h.pageX;var f=h.pageY;var j=this.vslider.position().top;var i=this.hslider.position().left;this.bindEvent(d,"mousemove",function(k){if(this.pressed==1){this.scroll(j+(k.pageY-f),i)}else{this.scroll(j,i+(k.pageX-g))}});this.bindEvent(d,"selectstart",function(k){k.preventDefault()})});this.bindEvent(d,"mouseup",function(f){if(this.pressed==1&&f.target!==this.vslider.get(0)){this.vslider.fadeTo(this.settings.sliderOpacityTime,this.settings.sliderOpacity)}else{if(this.pressed==2&&f.target!==this.hslider.get(0)){this.hslider.fadeTo(this.settings.sliderOpacityTime,this.settings.sliderOpacity)}}this.pressed=0;d.unbind("mousemove");d.unbind("selectstart")});this.bindEvent(this.container,"touchstart",function(h){var g=h.originalEvent;var f=g.changedTouches[0];this.touch.sx=f.pageX;this.touch.sy=f.pageY;this.touch.sv=this.vslider.position().top;this.touch.sh=this.hslider.position().left;this.sliders.stop().fadeTo(this.settings.sliderOpacityTime,1);g.stopPropagation()});this.bindEvent(this.container,"touchmove",function(h){var g=h.originalEvent;var f=g.targetTouches[0];this.scroll(this.touch.sv+(this.touch.sy-f.pageY)*this.settings.touchSpeed,this.touch.sh+(this.touch.sx-f.pageX)*this.settings.touchSpeed);g.preventDefault();g.stopPropagation()});this.bindEvent(this.container,"touchend touchcancel",function(h){var g=h.originalEvent;var f=g.changedTouches[0];this.sliders.stop().fadeTo(this.settings.sliderOpacityTime,this.settings.sliderOpacity);g.stopPropagation()});var c=this.vpath.height(),e=this.hpath.width();this.bindEvent(a(window),"resize",function(){this.pathSize();this.checkScroll();if(this.vdiff<=0){this.content.css("top",0)}if(this.hdiff<=0){this.content.css("left",0)}this.scroll(Math.round(parseInt(this.vslider.css("top"),10)*this.vpath.height()/c),Math.round(parseInt(this.hslider.css("left"),10)*this.hpath.width()/e));c=this.vpath.height();e=this.hpath.width()});this.bindEvent(this.container,"mousewheel",function(h,g,f,i){this.scroll(this.vslider.position().top-this.settings.wheelSpeed*i,this.hslider.position().left+this.settings.wheelSpeed*f,h);this.sliders.stop().fadeTo(this.settings.sliderOpacityTime,1);window.clearTimeout(this.timer);this.timer=window.setTimeout(this.fixFn(function(){this.sliders.stop().fadeTo(this.settings.sliderOpacityTime,this.settings.sliderOpacity)}),this.settings.sliderOpacityDelay);if(this.settings.blockGlobalScroll&&(this.vdiff||this.hdiff)){h.preventDefault();h.stopPropagation()}});this.bindEvent(d,"keydown",function(h){var f=0,g=0;g=(h.keyCode==38)?-this.settings.keyScroll:g;g=(h.keyCode==40)?this.settings.keyScroll:g;f=(h.keyCode==37)?-this.settings.keyScroll:f;f=(h.keyCode==39)?this.settings.keyScroll:f;if(g||f){this.easeScroll(g,f)}});this.bindEvent(this.container,"uscrollbar",function(j,g,i,f){if(g==="reset"){this.container.find(".scrollbar-content, .scrollbar-handle").stop().css({top:0,left:0});return}g=g||0;i=i||0;j.stopPropagation();if(/^[-\d\.]+$/.test(g)){g=parseFloat(g);if(Math.abs(g)<=1&&!f){g*=this.vtrack}else{g=g+g*(this.vtrack/this.vdiff-1)}}if(/^[-\d\.]+$/.test(i)){i=parseFloat(i);if(Math.abs(i)<=1&&!f){i*=this.htrack}else{i=i+i*(this.htrack/this.hdiff-1)}}this.easeScroll(g,i)})};a.fn.ClassyScroll=function(d){var c={scroll:"both",autoHide:true,autoHideTime:"fast",lazyCheckScroll:1000,blockGlobalScroll:false,contentFilter:"*",sliderSize:"30%",sliderOpacity:0.5,sliderOpacityTime:200,sliderOpacityDelay:1000,wheelSpeed:20,touchSpeed:0.3,pathPadding:"20px",keyScroll:100,scrollTime:500,scrollInterval:15,scrollEasing:"swing",zIndex:100,onscroll:function(){}};a.extend(c,d);return this.each(function(){new b(this,c)})}})(jQuery);